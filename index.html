<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pool Score Tracker (Full Control)</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: linear-gradient(to bottom right, #111827, #000000, #1e3a8a);
      color: white;
      min-height: 100vh;
    }

    .tab {
      padding: 12px 20px;
      border-radius: 16px;
      font-weight: bold;
      cursor: pointer;
      flex: 1;
      text-align: center;
    }
    .tab.active { background: #facc15; color: black; }

    .card {
      background: rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }

    .btn {
      padding: 10px 14px;
      border-radius: 14px;
      font-weight: bold;
      width: 100%;
      transition: 0.2s;
    }

    .btn:hover { transform: scale(1.03); }

    .bar { height: 18px; border-radius: 10px; background: #facc15; }

    .history {
      background: rgba(255,255,255,0.12);
      padding: 16px;
      border-radius: 18px;
      max-height: 200px;
      overflow-y: auto;
    }

  </style>
</head>

<body class="p-4 sm:p-8">

  <h1 class="text-4xl sm:text-5xl font-extrabold text-center mb-6">üé± Pool Score Tracker</h1>

  <!-- Tabs -->
  <div class="flex gap-2 mb-6">
    <div id="tab9" class="tab active">9-Ball</div>
    <div id="tab8" class="tab">8-Ball</div>
  </div>


  <!-- Players Section -->
  <div class="max-w-xl mx-auto mb-6 flex flex-col gap-3">
    <input id="playerName" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô..." class="px-4 py-3 rounded-xl text-black"/>

    <button id="addBtn" class="btn bg-yellow-400 text-black">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>

    <button id="clearPlayersBtn" class="btn bg-red-700">üóë ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    <button id="clearHistoryBtn" class="btn bg-red-900">üî• ‡∏•‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </div>


  <!-- Players Grid -->
  <div id="playersGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-10"></div>


  <!-- Analytics Dashboard -->
  <div class="max-w-4xl mx-auto space-y-6">

    <div class="card">
      <h2 class="text-2xl font-bold mb-3">üèÖ Leaderboard ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h2>
      <div id="leaderboard"></div>
    </div>

    <div class="card">
      <h2 class="text-2xl font-bold mb-3">üìà ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏ö‡πà‡∏≠‡∏¢‡∏™‡∏∏‡∏î</h2>
      <div id="winnerChart"></div>
    </div>

    <div class="card">
      <h2 class="text-2xl font-bold mb-3">üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</h2>
      <div id="avgChart"></div>
    </div>


    <div>
      <h2 class="text-2xl font-bold mb-3">üìÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h2>
      <div id="historyBox" class="history"></div>
    </div>

  </div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyADx5Fjh1OuUGyxxmuvzBMnNW09iizwEwc",
    authDomain: "poolscoretracker-abc76.firebaseapp.com",
    projectId: "poolscoretracker-abc76",
    storageBucket: "poolscoretracker-abc76.firebasestorage.app",
    messagingSenderId: "398668828315",
    appId: "1:398668828315:web:b59ac77fa48458c8be803e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);


  let mode="9ball";
  let players=[];
  let history=[];

  const grid=document.getElementById("playersGrid");
  const historyBox=document.getElementById("historyBox");

  const leaderboardEl=document.getElementById("leaderboard");
  const winnerChartEl=document.getElementById("winnerChart");
  const avgChartEl=document.getElementById("avgChart");


  async function saveData(){
    await setDoc(doc(db,"pool",mode),{players,history});
  }

  async function loadData(){
    const snap=await getDoc(doc(db,"pool",mode));
    if(snap.exists()){
      const d=snap.data();
      players=d.players||[];
      history=d.history||[];
    }
  }


  // ‚úÖ Render Players with Delete Button
  function renderPlayers(){
    grid.innerHTML="";

    players.forEach((p,index)=>{
      const card=document.createElement("div");
      card.className="card";

      card.innerHTML=`
        <h3 class="text-xl font-bold text-center">${p.name}</h3>
        <p class="text-center text-3xl font-extrabold mb-3">${p.score}</p>

        <button class="btn bg-red-600" onclick="window.deletePlayer(${index})">üóë ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
      `;

      grid.appendChild(card);
    });
  }


  // ‚úÖ Delete Single Player
  async function deletePlayer(i){
    if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return;
    players.splice(i,1);
    await saveData();
    refresh();
  }


  // ‚úÖ Clear Players All
  document.getElementById("clearPlayersBtn").addEventListener("click", async ()=>{
    if(!confirm("‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
    players=[];
    await saveData();
    refresh();
  });


  // ‚úÖ Clear History All
  document.getElementById("clearHistoryBtn").addEventListener("click", async ()=>{
    if(!confirm("‚ö†Ô∏è ‡∏•‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÜ‡πÑ‡∏´‡∏°?")) return;
    history=[];
    await saveData();
    refresh();
  });


  // Add Player
  document.getElementById("addBtn").addEventListener("click", async ()=>{
    const name=document.getElementById("playerName").value.trim();
    if(!name) return;

    players.push({name,score:0});
    document.getElementById("playerName").value="";

    await saveData();
    refresh();
  });


  // ‚úÖ Analytics Functions
  function monthKey(dateStr){
    const [d,m,y]=dateStr.split("/");
    return `${m}/${y}`;
  }

  function currentMonthKey(){
    return monthKey(new Date().toLocaleDateString("th-TH"));
  }


  function renderLeaderboard(){
    const wins={};
    const current=currentMonthKey();

    history.forEach(r=>{
      if(monthKey(r.date)===current){
        wins[r.winner]=(wins[r.winner]||0)+1;
      }
    });

    let sorted=Object.entries(wins).sort((a,b)=>b[1]-a[1]);

    if(sorted.length===0){ leaderboardEl.textContent="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ"; return; }

    const medals=["ü•á","ü•à","ü•â"];

    leaderboardEl.innerHTML=sorted.map(([name,count],i)=>{
      const medal=i<3?medals[i]:"";
      return `<div class="flex justify-between mb-2">
        <span>${medal} ${name}</span>
        <span>${count} Wins</span>
      </div>`;
    }).join("");
  }


  function renderWinnerChart(){
    const wins={};
    history.forEach(r=>{ wins[r.winner]=(wins[r.winner]||0)+1; });

    let sorted=Object.entries(wins).sort((a,b)=>b[1]-a[1]);
    if(sorted.length===0){ winnerChartEl.textContent="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; return; }

    const max=sorted[0][1];

    winnerChartEl.innerHTML=sorted.map(([name,count])=>`
      <div class="mb-3">
        <div class="flex justify-between text-sm">
          <span>${name}</span><span>${count}</span>
        </div>
        <div class="w-full bg-white/10 rounded-xl">
          <div class="bar" style="width:${(count/max)*100}%"></div>
        </div>
      </div>
    `).join("");
  }


  function renderAvgChart(){
    const daily={};

    history.forEach(r=>{
      if(!daily[r.date]) daily[r.date]=[];
      daily[r.date].push(r.winnerScore);
    });

    const entries=Object.entries(daily);
    if(entries.length===0){ avgChartEl.textContent="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; return; }

    avgChartEl.innerHTML=entries.map(([date,scores])=>{
      const avg=scores.reduce((a,b)=>a+b,0)/scores.length;
      return `
        <div class="mb-3">
          <div class="flex justify-between text-sm">
            <span>${date}</span>
            <span>${avg.toFixed(1)}</span>
          </div>
          <div class="w-full bg-white/10 rounded-xl">
            <div class="bar" style="width:${avg*10}%"></div>
          </div>
        </div>
      `;
    }).join("");
  }


  function renderHistory(){
    historyBox.innerHTML="";
    history.forEach(h=>{
      const div=document.createElement("div");
      div.className="p-2 mb-2 rounded-xl bg-black/40";
      div.textContent=`${h.date} | Winner: ${h.winner}`;
      historyBox.appendChild(div);
    });
  }


  function refresh(){
    renderPlayers();
    renderLeaderboard();
    renderWinnerChart();
    renderAvgChart();
    renderHistory();
  }


  // Tabs
  async function switchMode(newMode){
    mode=newMode;
    await loadData();
    refresh();

    document.getElementById("tab9").classList.toggle("active",mode==="9ball");
    document.getElementById("tab8").classList.toggle("active",mode==="8ball");
  }

  document.getElementById("tab9").addEventListener("click",()=>switchMode("9ball"));
  document.getElementById("tab8").addEventListener("click",()=>switchMode("8ball"));


  // Init
  await switchMode("9ball");


  window.deletePlayer=deletePlayer;
</script>

</body>
</html>
